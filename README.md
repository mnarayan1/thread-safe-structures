Thread-safe implementation of basic data structures in C